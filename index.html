<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Creative Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .ad-canvas {
            width: 1080px;
            height: 1080px;
            transform-origin: top left;
            transform: scale(0.3);
            margin: 0 auto;
        }
        .ad-card-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Main Header -->
    <header class="text-center py-12 px-4">
        <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
            Ad Creative Generator
        </h1>
        <p class="text-xl text-gray-300 max-w-2xl mx-auto">
            A gallery of ad templates. Click 'Download' to export any ad as a 1080x1080 PNG.
        </p>
    </header>

    <!-- Ad Gallery with Sidebar -->
    <main class="max-w-7xl mx-auto px-4 pb-12">
        <div class="flex gap-6">
            <!-- Sidebar -->
            <aside class="w-64 shrink-0 bg-gray-800/60 border border-gray-700 rounded-xl h-fit sticky top-6 self-start">
                <div class="p-4 border-b border-gray-700">
                    <h2 class="text-lg font-semibold text-gray-200">Templates</h2>
                </div>
                <nav class="p-2" id="template-nav">
                    <button data-target="template-1" class="template-link w-full text-left px-4 py-3 rounded-lg text-gray-200 hover:bg-gray-700/60 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        1. Gradient Splash
                    </button>
                    <button data-target="template-2" class="template-link w-full text-left px-4 py-3 rounded-lg text-gray-200 hover:bg-gray-700/60 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        2. Minimalist Tech
                    </button>
                    <button data-target="template-3" class="template-link w-full text-left px-4 py-3 rounded-lg text-gray-200 hover:bg-gray-700/60 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        3. Nature & Wellness
                    </button>
                </nav>
            </aside>

            <!-- Main Canvas Area: show one at a time -->
            <section class="flex-1">
                
                <!-- Ad Template 1: Gradient Splash -->
                <div id="template-1" class="template-view">
                    <div class="ad-card bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
                <div class="p-6 border-b border-gray-700">
                    <h3 class="text-xl font-semibold text-white">Ad Template 1: Gradient Splash</h3>
                </div>
                
                <div class="ad-card-container p-6">
                    <div id="ad-canvas-1" class="ad-canvas">
                        <div class="w-full h-full bg-gradient-to-br from-purple-600 via-pink-500 to-red-500 flex flex-col items-center justify-center text-white relative overflow-hidden">
                            <!-- Background Pattern -->
                            <div class="absolute inset-0 opacity-20">
                                <div class="absolute top-10 left-10 w-32 h-32 bg-white rounded-full"></div>
                                <div class="absolute top-32 right-20 w-24 h-24 bg-white rounded-full"></div>
                                <div class="absolute bottom-20 left-20 w-40 h-40 bg-white rounded-full"></div>
                                <div class="absolute bottom-32 right-10 w-28 h-28 bg-white rounded-full"></div>
                            </div>
                            
                            <!-- Main Content -->
                            <div class="relative z-10 text-center px-16">
                                <h1 class="text-6xl font-bold mb-6 drop-shadow-lg">SALE</h1>
                                <h2 class="text-4xl font-semibold mb-4">50% OFF</h2>
                                <p class="text-2xl mb-8 opacity-90">Everything Must Go!</p>
                                <div class="bg-white text-purple-600 px-8 py-4 rounded-full text-2xl font-bold inline-block">
                                    SHOP NOW
                                </div>
                            </div>
                            
                            <!-- Decorative Elements -->
                            <div class="absolute top-4 right-4 text-6xl opacity-30">ðŸ”¥</div>
                            <div class="absolute bottom-4 left-4 text-4xl opacity-30">âš¡</div>
                        </div>
                    </div>
                </div>
                
                <div class="p-6 border-t border-gray-700">
                    <button onclick="downloadAd('ad-canvas-1', 'ad-template-1-gradient-splash.png')" 
                            class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg">
                        Download as PNG
                    </button>
                </div>
            </div>
                </div>

                <!-- Ad Template 2: Minimalist Tech -->
                <div id="template-2" class="template-view hidden">
                    <div class="ad-card bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
                <div class="p-6 border-b border-gray-700">
                    <h3 class="text-xl font-semibold text-white">Ad Template 2: Minimalist Tech</h3>
                </div>
                
                <div class="ad-card-container p-6">
                    <div id="ad-canvas-2" class="ad-canvas">
                        <div class="w-full h-full bg-gray-900 flex flex-col items-center justify-center text-white relative">
                            <!-- Grid Background -->
                            <div class="absolute inset-0 opacity-5">
                                <div class="grid grid-cols-12 grid-rows-12 h-full">
                                    <div class="border border-white"></div>
                                    <div class="border border-white"></div>
                                    <div class="border border-white"></div>
                                    <div class="border border-white"></div>
                                    <div class="border border-white"></div>
                                    <div class="border border-white"></div>
                                    <div class="border border-white"></div>
                                    <div class="border border-white"></div>
                                    <div class="border border-white"></div>
                                    <div class="border border-white"></div>
                                    <div class="border border-white"></div>
                                    <div class="border border-white"></div>
                                </div>
                            </div>
                            
                            <!-- Main Content -->
                            <div class="text-center px-20 relative z-10">
                                <div class="w-24 h-24 bg-blue-500 rounded-full mx-auto mb-8 flex items-center justify-center">
                                    <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <h1 class="text-5xl font-light mb-4 tracking-wide">INNOVATE</h1>
                                <h2 class="text-3xl font-medium mb-6 text-gray-300">The Future is Here</h2>
                                <p class="text-xl text-gray-400 mb-8 max-w-md">Transform your business with cutting-edge technology solutions.</p>
                                <div class="border-2 border-blue-500 text-blue-500 px-8 py-3 rounded-full text-xl font-medium inline-block hover:bg-blue-500 hover:text-white transition-colors duration-200">
                                    LEARN MORE
                                </div>
                            </div>
                            
                            <!-- Corner Accent -->
                            <div class="absolute top-8 right-8 w-16 h-16 border-t-2 border-r-2 border-blue-500"></div>
                            <div class="absolute bottom-8 left-8 w-16 h-16 border-b-2 border-l-2 border-blue-500"></div>
                        </div>
                    </div>
                </div>
                
                <div class="p-6 border-t border-gray-700">
                    <button onclick="downloadAd('ad-canvas-2', 'ad-template-2-minimalist-tech.png')" 
                            class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg">
                        Download as PNG
                    </button>
                </div>
            </div>
                </div>

                <!-- Ad Template 3: Nature & Wellness -->
                <div id="template-3" class="template-view hidden">
                    <div class="ad-card bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
                <div class="p-6 border-b border-gray-700">
                    <h3 class="text-xl font-semibold text-white">Ad Template 3: Nature & Wellness</h3>
                </div>
                
                <div class="ad-card-container p-6">
                    <div id="ad-canvas-3" class="ad-canvas">
                        <div class="w-full h-full bg-gradient-to-b from-green-400 to-green-600 flex flex-col items-center justify-center text-white relative overflow-hidden">
                            <!-- Nature Elements -->
                            <div class="absolute inset-0">
                                <!-- Trees -->
                                <div class="absolute bottom-0 left-20 w-8 h-32 bg-green-800 rounded-t-full"></div>
                                <div class="absolute bottom-0 right-32 w-6 h-28 bg-green-800 rounded-t-full"></div>
                                <div class="absolute bottom-0 right-16 w-10 h-36 bg-green-800 rounded-t-full"></div>
                                
                                <!-- Leaves -->
                                <div class="absolute top-32 left-16 w-16 h-16 bg-green-300 rounded-full opacity-60"></div>
                                <div class="absolute top-28 right-24 w-12 h-12 bg-green-300 rounded-full opacity-60"></div>
                                <div class="absolute top-36 right-8 w-14 h-14 bg-green-300 rounded-full opacity-60"></div>
                                
                                <!-- Sun -->
                                <div class="absolute top-8 right-8 w-20 h-20 bg-yellow-300 rounded-full opacity-80"></div>
                            </div>
                            
                            <!-- Main Content -->
                            <div class="text-center px-16 relative z-10">
                                <div class="text-6xl mb-4">ðŸŒ±</div>
                                <h1 class="text-5xl font-bold mb-4 drop-shadow-lg">NATURAL</h1>
                                <h2 class="text-3xl font-semibold mb-4">Wellness</h2>
                                <p class="text-2xl mb-8 opacity-90">Embrace a healthier lifestyle</p>
                                <div class="bg-white text-green-600 px-8 py-4 rounded-full text-2xl font-bold inline-block shadow-lg">
                                    START TODAY
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="p-6 border-t border-gray-700">
                    <button onclick="downloadAd('ad-canvas-3', 'ad-template-3-nature-wellness.png')" 
                            class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg">
                        Download as PNG
                    </button>
                </div>
            </div>
                </div>

            </section>
        </div>
    </main>

    <!-- Load html2canvas library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
        // The final, bulletproof download function
        async function downloadAd(elementId, filename) {
            const element = document.getElementById(elementId);
            const button = event.target;
            const originalText = button.textContent;

            button.textContent = 'Generating...';
            button.disabled = true;

            try {
                // 1. COMMAND THE FONT LOAD: Instead of asking if fonts are ready, we explicitly
                // command the browser to load 'Inter' and wait for it to finish.
                // This is the most crucial part of the fix.
                await document.fonts.load('1em Inter');

                const clone = element.cloneNode(true);
                clone.style.position = 'absolute';
                clone.style.left = '-9999px';
                clone.style.top = '-9999px';
                clone.style.zIndex = '1000';
                clone.style.width = '1080px';
                clone.style.height = '1080px';
                clone.style.transform = 'scale(1)';
                clone.style.transformOrigin = 'top left';
                document.body.appendChild(clone);

                const options = {
                    scale: 1,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: null,
                    width: 1080,
                    height: 1080,
                    logging: false
                };

                // 2. WAIT FOR BROWSER PAINT: As a final safeguard, we wait for the next
                // animation frame. This guarantees the browser has processed the cloned
                // element's layout and is ready to capture it accurately.
                requestAnimationFrame(async () => {
                    try {
                        const canvas = await html2canvas(clone, options);
                        const link = document.createElement('a');
                        link.download = filename;
                        link.href = canvas.toDataURL('image/png');
                        link.click();

                        button.textContent = 'Downloaded!';
                        setTimeout(() => {
                            button.textContent = originalText;
                        }, 2000);
                    } catch (error) {
                        console.error('Error during html2canvas capture:', error);
                        button.textContent = 'Capture Error';
                    } finally {
                        // 3. CLEANUP: Always remove the clone and re-enable the button.
                        document.body.removeChild(clone);
                        button.disabled = false;
                        if(button.textContent === 'Capture Error') {
                            setTimeout(() => {
                                button.textContent = originalText;
                            }, 3000);
                        }
                    }
                });

            } catch (error) {
                console.error('Error loading font or preparing clone:', error);
                button.textContent = 'Font Error';
                button.disabled = false;
                setTimeout(() => {
                    button.textContent = originalText;
                }, 3000);
            }
        }
        
        // Add some interactive effects
        document.addEventListener('DOMContentLoaded', function() {
            // Sidebar switching logic
            const links = document.querySelectorAll('.template-link');
            const views = document.querySelectorAll('.template-view');

            function setActive(targetId) {
                views.forEach(v => v.classList.add('hidden'));
                const active = document.getElementById(targetId);
                if (active) active.classList.remove('hidden');

                links.forEach(l => l.classList.remove('bg-gray-700'));
                links.forEach(l => {
                    if (l.getAttribute('data-target') === targetId) {
                        l.classList.add('bg-gray-700');
                    }
                });
            }

            links.forEach(link => {
                link.addEventListener('click', () => setActive(link.getAttribute('data-target')));
            });

            // Initialize first template as active
            setActive('template-1');
        });
    </script>
</body>
</html>